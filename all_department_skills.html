<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Departments</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            width: 80%;
            margin: 0 auto;
        }

        .department, .sub-department, .skills-category {
            cursor: pointer;
            padding: 10px;
            margin: 5px 0;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
        }

        .hidden {
            display: none;
        }

        .skills-category {
            padding-left: 20px;
        }

        .skill {
            padding-left: 40px;
        }

        .skills-list {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="company" class="department">Top Departments in a Company:</div>
        <div id="departments-container"></div>
    </div>
    <script>
        const departments = [
            'Finance', 'HR', 'IT', 'Product', 'Legal', 'Corporate Strategy',
            'Customer Service', 'Sales', 'Marketing', 'Operations'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const departmentsContainer = document.getElementById('departments-container');
            departments.forEach(dept => {
                const deptDiv = document.createElement('div');
                deptDiv.id = `${dept.toLowerCase()}-dept`;
                deptDiv.className = 'department';
                deptDiv.textContent = dept;
                deptDiv.addEventListener('click', () => {
                    fetch(`../jobs-skills-data/${dept.toLowerCase().replace(' ', '_')}_skills.json`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log(`Data for ${dept}:`, data);  // Log the fetched data
                            const skills = data[dept];
                            console.log(`Skills for ${dept}:`, skills);  // Log the extracted skills
                            if (!skills) {
                                throw new Error(`No skills found for department: ${dept}`);
                            }
                            toggleDisplay(skills, deptDiv, 'sub-department');
                        })
                        .catch(error => {
                            console.error('Error loading skills data:', error);
                            alert(`Error loading skills data for ${dept}: ${error.message}`);
                        });
                });
                departmentsContainer.appendChild(deptDiv);
            });
        });

        function toggleDisplay(skillsObj, parentElement, className) {
            console.log(`Toggling display for ${className}:`, skillsObj);  // Log the skills object
            const existingElements = parentElement.querySelectorAll(`.${className}`);
            if (existingElements.length > 0) {
                existingElements.forEach(el => el.remove());
            } else {
                for (const [key, value] of Object.entries(skillsObj)) {
                    const div = document.createElement('div');
                    div.className = className;
                    div.textContent = key;

                    if (Array.isArray(value)) {
                        div.addEventListener('click', (event) => {
                            event.stopPropagation();
                            toggleSkills(value, div);
                        });
                    } else {
                        div.addEventListener('click', (event) => {
                            event.stopPropagation();
                            toggleDisplay(value, div, className === 'sub-department' ? 'skills-category' : 'skill');
                        });
                    }
                    parentElement.appendChild(div);
                }
            }
        }

        function toggleSkills(skillsArray, parentElement) {
            console.log('Toggling skills:', skillsArray);  // Log the skills array
            const existingSkills = parentElement.querySelector('.skills-list');
            if (existingSkills) {
                existingSkills.remove();
            } else {
                const ul = document.createElement('ul');
                ul.className = 'skills-list';
                skillsArray.forEach(skill => {
                    const li = document.createElement('li');
                    li.className = 'skill';
                    li.textContent = skill;
                    ul.appendChild(li);
                });
                parentElement.appendChild(ul);
            }
        }
    </script>
</body>
</html>